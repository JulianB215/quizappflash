<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quiz Master</title>
    
    <!-- PWA Meta Tags pour iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Quiz Master">
    <meta name="theme-color" content="#4F46E5">
    
    <!-- Icône pour l'écran d'accueil iOS -->
    <!-- Remplacez "icon.png" par le nom de votre fichier image si différent -->
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon.png">
    
    <!-- Favicon pour les navigateurs -->
    <link rel="icon" type="image/png" sizes="32x32" href="icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon.png">
    
    <!-- Meta tags standards -->
    <meta name="description" content="Application de quiz interactive pour tester vos connaissances">
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Empêcher le zoom sur iOS */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        /* Plein écran sur iOS */
        body {
            overscroll-behavior: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        input, textarea {
            -webkit-user-select: text;
            user-select: text;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Icônes simples en SVG
        const Check = () => <svg className="inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"></polyline></svg>;
        const X = () => <svg className="inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const Plus = () => <svg className="inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const Play = () => <svg className="inline" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>;
        const Eye = () => <svg className="inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>;
        const Trash = () => <svg className="inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
        const Edit = () => <svg className="inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>;
        const Download = () => <svg className="inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>;
        const Upload = () => <svg className="inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>;
        const Shuffle = () => <svg className="inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="16 3 21 3 21 8"></polyline><line x1="4" y1="20" x2="21" y2="3"></line><polyline points="21 16 21 21 16 21"></polyline><line x1="15" y1="15" x2="21" y2="21"></line><line x1="4" y1="4" x2="9" y2="9"></line></svg>;

        function QuizApp() {
  const [mode, setMode] = useState('menu'); // menu, create, play
  
  // Charger les quiz depuis localStorage au démarrage
  const [quizzes, setQuizzes] = useState(() => {
    const savedQuizzes = localStorage.getItem('quizMasterData');
    if (savedQuizzes) {
      return JSON.parse(savedQuizzes);
    }
    // Quiz par défaut si aucun n'est sauvegardé
    return [
      {
        id: 1,
        title: "Capitales Européennes",
        category: "Géographie",
        questions: [
          { question: "Capitale de la France", answers: ["Paris"], displayAnswer: "Paris", hint: "" },
          { question: "Capitale de l'Allemagne", answers: ["Berlin"], displayAnswer: "Berlin", hint: "" },
          { question: "Capitale de l'Italie", answers: ["Rome"], displayAnswer: "Rome", hint: "" },
          { question: "Capitale de l'Espagne", answers: ["Madrid"], displayAnswer: "Madrid", hint: "" },
          { question: "Capitale du Portugal", answers: ["Lisbonne", "Lisbone"], displayAnswer: "Lisbonne", hint: "" }
        ]
      }
    ];
  });

  // Catégories prédéfinies
  const categories = [
    "Géographie",
    "Histoire",
    "Sciences",
    "Littérature",
    "Sport",
    "Culture générale",
    "Langues",
    "Art",
    "Musique",
    "Cinéma",
    "Cuisine",
    "Autre"
  ];
  
  const [currentQuiz, setCurrentQuiz] = useState(null);
  const [userAnswers, setUserAnswers] = useState({});
  const [searchInput, setSearchInput] = useState('');
  const [quizFinished, setQuizFinished] = useState(false);
  const [newQuizTitle, setNewQuizTitle] = useState('');
  const [newQuizData, setNewQuizData] = useState('');
  const [newQuizCategory, setNewQuizCategory] = useState('Culture générale');
  const [selectedCategory, setSelectedCategory] = useState('Toutes');
  const [editingQuizId, setEditingQuizId] = useState(null);
  const inputRef = useRef(null);

  // Sauvegarder les quiz dans localStorage à chaque modification
  useEffect(() => {
    localStorage.setItem('quizMasterData', JSON.stringify(quizzes));
  }, [quizzes]);

  useEffect(() => {
    if (mode === 'play' && inputRef.current) {
      inputRef.current.focus();
    }
  }, [mode]);

  const normalizeText = (text) => {
    return text
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .trim();
  };

  const handleSearchChange = (e) => {
    const value = e.target.value;
    setSearchInput(value);

    if (value.trim() && currentQuiz && !quizFinished) {
      const normalizedInput = normalizeText(value);
      
      currentQuiz.questions.forEach((item, index) => {
        if (!userAnswers[index]) {
          // Vérifier toutes les réponses possibles
          const answers = item.answers || [item.answer]; // Compatibilité ancien format
          const isCorrect = answers.some(answer => 
            normalizeText(answer) === normalizedInput
          );
          
          if (isCorrect) {
            // Trouver quelle réponse exacte a été donnée
            const matchedAnswer = answers.find(answer => 
              normalizeText(answer) === normalizedInput
            );
            const newAnswers = { ...userAnswers, [index]: matchedAnswer };
            setUserAnswers(newAnswers);
            setSearchInput('');
            
            // Terminer automatiquement si toutes les réponses sont correctes
            if (Object.keys(newAnswers).length === currentQuiz.questions.length) {
              setTimeout(() => setQuizFinished(true), 300);
            }
          }
        }
      });
    }
  };

  const startQuiz = (quiz) => {
    setCurrentQuiz(quiz);
    setUserAnswers({});
    setSearchInput('');
    setQuizFinished(false);
    setMode('play');
  };

  const shuffleQuestions = () => {
    if (!currentQuiz) return;
    
    // Créer une copie du quiz avec les questions mélangées
    const shuffledQuestions = [...currentQuiz.questions]
      .sort(() => Math.random() - 0.5);
    
    setCurrentQuiz({
      ...currentQuiz,
      questions: shuffledQuestions
    });
    
    // Réinitialiser les réponses
    setUserAnswers({});
    setSearchInput('');
    setQuizFinished(false);
  };

  const finishQuiz = () => {
    setQuizFinished(true);
  };

  const deleteQuiz = (quizId, e) => {
    e.stopPropagation(); // Empêcher le clic de démarrer le quiz
    if (confirm('Êtes-vous sûr de vouloir supprimer ce quiz ?')) {
      setQuizzes(prev => prev.filter(q => q.id !== quizId));
    }
  };

  const editQuiz = (quiz, e) => {
    e.stopPropagation(); // Empêcher le clic de démarrer le quiz
    setEditingQuizId(quiz.id);
    setNewQuizTitle(quiz.title);
    setNewQuizCategory(quiz.category || 'Culture générale');
    
    // Convertir les questions en format texte
    const quizText = quiz.questions.map(q => {
      let line = q.question + ';' + q.answers.join(';');
      if (q.image) {
        line += ' [IMG:' + q.image + ']';
      }
      if (q.hint) {
        line += ' (' + q.hint + ')';
      }
      return line;
    }).join('\n');
    
    setNewQuizData(quizText);
    setMode('create');
  };

  const createQuiz = () => {
    if (!newQuizTitle.trim() || !newQuizData.trim()) {
      alert('Veuillez remplir le titre et les données du quiz');
      return;
    }

    const lines = newQuizData.split('\n').filter(line => line.trim());
    const questions = lines.map(line => {
      const parts = line.split(';').map(s => s.trim());
      if (parts.length < 2) return null;
      
      const question = parts[0];
      const answersPart = parts.slice(1).join(';'); // Rejoindre au cas où il y a des ; dans les réponses
      
      // Extraire l'URL de l'image entre [IMG:...] s'il existe
      let image = '';
      let processedAnswersPart = answersPart;
      const imageMatch = answersPart.match(/\[IMG:([^\]]+)\]/);
      if (imageMatch) {
        image = imageMatch[1];
        processedAnswersPart = answersPart.replace(/\s*\[IMG:[^\]]+\]/, '');
      }
      
      // Extraire l'indice entre parenthèses s'il existe
      let hint = '';
      let answersText = processedAnswersPart;
      const hintMatch = processedAnswersPart.match(/\(([^)]+)\)$/);
      if (hintMatch) {
        hint = hintMatch[1];
        answersText = processedAnswersPart.replace(/\s*\([^)]+\)$/, '');
      }
      
      // Séparer les réponses multiples par des points-virgules
      const answers = answersText.split(';').map(a => a.trim()).filter(a => a);
      
      if (answers.length === 0) return null;
      
      return { 
        question, 
        answers, // Tableau de réponses acceptées
        hint,    // Indice à afficher
        image,   // URL de l'image
        displayAnswer: answers[0] // Première réponse pour l'affichage
      };
    }).filter(q => q !== null);

    if (questions.length === 0) {
      alert('Aucune question valide trouvée. Format: Question;Réponse1;Réponse2 (indice)');
      return;
    }

    if (editingQuizId) {
      // Mode édition : mettre à jour le quiz existant
      setQuizzes(prev => prev.map(quiz => 
        quiz.id === editingQuizId 
          ? { ...quiz, title: newQuizTitle, category: newQuizCategory, questions }
          : quiz
      ));
      setEditingQuizId(null);
    } else {
      // Mode création : ajouter un nouveau quiz
      const newQuiz = {
        id: Date.now(),
        title: newQuizTitle,
        category: newQuizCategory,
        questions
      };
      setQuizzes(prev => [...prev, newQuiz]);
    }

    setNewQuizTitle('');
    setNewQuizData('');
    setNewQuizCategory('Culture générale');
    setMode('menu');
  };

  const exportQuizzes = () => {
    const dataStr = JSON.stringify(quizzes, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'mes-quiz.json';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
    alert('Quiz exportés avec succès ! Le fichier "mes-quiz.json" a été téléchargé.');
  };

  const importQuizzes = (event) => {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const importedQuizzes = JSON.parse(e.target.result);
        
        if (!Array.isArray(importedQuizzes)) {
          alert('Format de fichier invalide. Le fichier doit contenir un tableau de quiz.');
          return;
        }

        // Vérifier que les quiz ont la bonne structure
        const validQuizzes = importedQuizzes.filter(quiz => 
          quiz.title && quiz.questions && Array.isArray(quiz.questions)
        );

        if (validQuizzes.length === 0) {
          alert('Aucun quiz valide trouvé dans le fichier.');
          return;
        }

        // Demander si on veut remplacer ou fusionner
        const replace = confirm(
          `${validQuizzes.length} quiz trouvé(s).\n\n` +
          'Voulez-vous REMPLACER tous vos quiz actuels ?\n' +
          '- OK = Remplacer (vos quiz actuels seront supprimés)\n' +
          '- Annuler = Fusionner (ajouter aux quiz existants)'
        );

        if (replace) {
          setQuizzes(validQuizzes);
          alert(`${validQuizzes.length} quiz importé(s) avec succès ! Vos anciens quiz ont été remplacés.`);
        } else {
          // Fusionner en évitant les doublons d'ID
          const existingIds = new Set(quizzes.map(q => q.id));
          const newQuizzes = validQuizzes.map(quiz => {
            if (existingIds.has(quiz.id)) {
              return { ...quiz, id: Date.now() + Math.random() };
            }
            return quiz;
          });
          setQuizzes(prev => [...prev, ...newQuizzes]);
          alert(`${validQuizzes.length} quiz ajouté(s) avec succès !`);
        }

        // Réinitialiser l'input file
        event.target.value = '';
      } catch (error) {
        alert('Erreur lors de la lecture du fichier. Assurez-vous que c\'est un fichier JSON valide.');
        console.error(error);
      }
    };
    reader.readAsText(file);
  };


  const answeredCount = Object.keys(userAnswers).length;
  const totalCount = currentQuiz?.questions.length || 0;

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
      <div className="max-w-4xl mx-auto">
        {/* Header */}
        <div className="bg-white rounded-lg shadow-lg p-4 md:p-6 mb-4 md:mb-6">
          <h1 className="text-3xl md:text-4xl font-bold text-indigo-600 text-center mb-2">
            Quiz Master
          </h1>
          <p className="text-sm md:text-base text-gray-600 text-center">
            Testez vos connaissances !
          </p>
        </div>

        {/* Menu */}
        {mode === 'menu' && (
          <div className="space-y-4">
            <div className="bg-white rounded-lg shadow-lg p-4 md:p-6">
              <div className="mb-4">
                <h2 className="text-2xl font-bold text-gray-800 mb-3">Mes Quiz</h2>
                <div className="flex flex-wrap gap-2">
                  <button
                    onClick={exportQuizzes}
                    className="flex items-center gap-2 bg-green-600 text-white px-3 py-2 text-sm md:px-4 md:text-base rounded-lg hover:bg-green-700 transition"
                    title="Exporter tous les quiz"
                  >
                    <Download />
                    <span className="hidden sm:inline">Exporter</span>
                  </button>
                  <label className="flex items-center gap-2 bg-blue-600 text-white px-3 py-2 text-sm md:px-4 md:text-base rounded-lg hover:bg-blue-700 transition cursor-pointer">
                    <Upload />
                    <span className="hidden sm:inline">Importer</span>
                    <input
                      type="file"
                      accept=".json"
                      onChange={importQuizzes}
                      className="hidden"
                    />
                  </label>
                  <button
                    onClick={() => setMode('create')}
                    className="flex items-center gap-2 bg-indigo-600 text-white px-3 py-2 text-sm md:px-4 md:text-base rounded-lg hover:bg-indigo-700 transition"
                  >
                    <Plus />
                    <span className="hidden sm:inline">Créer</span>
                  </button>
                </div>
              </div>

              {/* Filtre par catégorie */}
              <div className="mb-4">
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Filtrer par catégorie
                </label>
                <div className="flex flex-wrap gap-2">
                  <button
                    onClick={() => setSelectedCategory('Toutes')}
                    className={`px-3 py-1.5 text-sm rounded-lg transition ${
                      selectedCategory === 'Toutes'
                        ? 'bg-indigo-600 text-white'
                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                    }`}
                  >
                    Toutes
                  </button>
                  {categories.map(cat => (
                    <button
                      key={cat}
                      onClick={() => setSelectedCategory(cat)}
                      className={`px-3 py-1.5 text-sm rounded-lg transition ${
                        selectedCategory === cat
                          ? 'bg-indigo-600 text-white'
                          : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                      }`}
                    >
                      {cat}
                    </button>
                  ))}
                </div>
              </div>
              
              <div className="grid gap-4">
                {quizzes
                  .filter(quiz => selectedCategory === 'Toutes' || quiz.category === selectedCategory)
                  .map(quiz => (
                  <div
                    key={quiz.id}
                    className="border border-gray-200 rounded-lg p-3 md:p-4 hover:border-indigo-400 transition cursor-pointer"
                    onClick={() => startQuiz(quiz)}
                  >
                    <div className="flex justify-between items-start gap-2">
                      <div className="flex-1 min-w-0">
                        <div className="flex flex-wrap items-center gap-2 mb-1">
                          <h3 className="text-lg md:text-xl font-semibold text-gray-800 break-words">
                            {quiz.title}
                          </h3>
                          <span className="px-2 py-0.5 text-xs font-medium bg-indigo-100 text-indigo-700 rounded whitespace-nowrap">
                            {quiz.category || 'Non classé'}
                          </span>
                        </div>
                        <p className="text-sm text-gray-600">
                          {quiz.questions.length} questions
                        </p>
                      </div>
                      <div className="flex items-center gap-1 md:gap-2 flex-shrink-0">
                        <button
                          onClick={(e) => editQuiz(quiz, e)}
                          className="text-blue-500 hover:text-blue-700 hover:bg-blue-50 p-1.5 md:p-2 rounded transition"
                          title="Éditer ce quiz"
                        >
                          <Edit />
                        </button>
                        <button
                          onClick={(e) => deleteQuiz(quiz.id, e)}
                          className="text-red-500 hover:text-red-700 hover:bg-red-50 p-1.5 md:p-2 rounded transition"
                          title="Supprimer ce quiz"
                        >
                          <Trash />
                        </button>
                        <div className="ml-1">
                          <Play />
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        )}

        {/* Create Quiz */}
        {mode === 'create' && (
          <div className="bg-white rounded-lg shadow-lg p-4 md:p-6">
            <h2 className="text-xl md:text-2xl font-bold text-gray-800 mb-4">
              {editingQuizId ? 'Éditer le quiz' : 'Créer un nouveau quiz'}
            </h2>
            
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Titre du quiz
                </label>
                <input
                  type="text"
                  value={newQuizTitle}
                  onChange={(e) => setNewQuizTitle(e.target.value)}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                  placeholder="Ex: Capitales du monde"
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Catégorie
                </label>
                <select
                  value={newQuizCategory}
                  onChange={(e) => setNewQuizCategory(e.target.value)}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                >
                  {categories.map(cat => (
                    <option key={cat} value={cat}>{cat}</option>
                  ))}
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Questions et réponses
                </label>
                <p className="text-sm text-gray-600 mb-2">
                  Format: Question;Réponse1;Réponse2 [IMG:url] (info complémentaire)
                </p>
                <div className="text-xs text-gray-500 mb-2 space-y-1">
                  <div>• Une question par ligne</div>
                  <div>• Séparez les réponses multiples par des ;</div>
                  <div>• Ajoutez [IMG:url_de_image] pour afficher une image (optionnel)</div>
                  <div>• Ajoutez une info entre parenthèses qui s'affichera avec la réponse (optionnel)</div>
                </div>
                <textarea
                  value={newQuizData}
                  onChange={(e) => setNewQuizData(e.target.value)}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent h-64 font-mono text-sm"
                  placeholder="Capitale de la France;Paris&#10;Quel pays ?;France [IMG:https://example.com/drapeau.jpg]&#10;Auteur de Germinal;Emile Zola;Zola (écrivain français, 1840-1902)"
                />
              </div>

              <div className="flex flex-col sm:flex-row gap-3">
                <button
                  onClick={createQuiz}
                  className="flex-1 bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition font-medium"
                >
                  {editingQuizId ? 'Enregistrer les modifications' : 'Créer le quiz'}
                </button>
                <button
                  onClick={() => {
                    setMode('menu');
                    setEditingQuizId(null);
                    setNewQuizTitle('');
                    setNewQuizData('');
                    setNewQuizCategory('Culture générale');
                  }}
                  className="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition"
                >
                  Annuler
                </button>
              </div>
            </div>
          </div>
        )}

        {/* Play Quiz */}
        {mode === 'play' && currentQuiz && (
          <div className="space-y-4">
            {/* Quiz Header - Fixe en haut */}
            <div className="sticky top-0 z-10 bg-white rounded-lg shadow-lg p-4 md:p-6">
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-xl md:text-2xl font-bold text-gray-800 break-words mr-2 flex-1">
                  {currentQuiz.title}
                </h2>
                <button
                  onClick={() => setMode('menu')}
                  className="text-gray-600 hover:text-gray-800 flex-shrink-0"
                >
                  <X />
                </button>
              </div>

              <div className="flex gap-4 items-center mb-4">
                <div className="flex-1 bg-gray-200 rounded-full h-3">
                  <div
                    className="bg-indigo-600 h-3 rounded-full transition-all duration-300"
                    style={{ width: `${(answeredCount / totalCount) * 100}%` }}
                  />
                </div>
                <span className="font-bold text-lg text-gray-700">
                  {answeredCount}/{totalCount}
                </span>
              </div>

              {!quizFinished && (
                <div className="space-y-3">
                  <input
                    ref={inputRef}
                    type="text"
                    value={searchInput}
                    onChange={handleSearchChange}
                    className="w-full px-4 py-3 border-2 border-indigo-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-lg"
                    placeholder="Tapez votre réponse..."
                  />
                  <div className="flex flex-col sm:flex-row gap-2">
                    <button
                      onClick={shuffleQuestions}
                      className="flex items-center justify-center gap-2 bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700 transition font-medium"
                    >
                      <Shuffle />
                      Mélanger
                    </button>
                    <button
                      onClick={finishQuiz}
                      className="flex-1 flex items-center justify-center gap-2 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition font-medium"
                    >
                      <Eye />
                      Terminer et voir les réponses
                    </button>
                  </div>
                </div>
              )}
            </div>

            {/* Questions Table */}
            <div className="bg-white rounded-lg shadow-lg overflow-hidden">
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead className="bg-indigo-600 text-white">
                    <tr>
                      <th className="px-3 md:px-6 py-3 text-left text-sm md:text-base">Question</th>
                      <th className="px-3 md:px-6 py-3 text-left text-sm md:text-base">Réponse</th>
                    </tr>
                  </thead>
                  <tbody>
                    {currentQuiz.questions.map((item, index) => (
                      <tr
                        key={index}
                        className={`border-b ${
                          userAnswers[index]
                            ? 'bg-green-50'
                            : quizFinished
                            ? 'bg-red-50'
                            : ''
                        }`}
                      >
                        <td className="px-3 md:px-6 py-3 md:py-4 text-sm md:text-base text-gray-800">
                          <div>
                            {item.question}
                            {item.image && (
                              <div className="mt-2">
                                <img 
                                  src={item.image} 
                                  alt="Question" 
                                  className="max-w-full h-auto rounded-lg shadow-md max-h-48 md:max-h-64"
                                  onError={(e) => {
                                    e.target.style.display = 'none';
                                    e.target.nextSibling.style.display = 'block';
                                  }}
                                />
                                <div className="hidden text-xs text-red-500 mt-1">
                                  ⚠️ Image non disponible
                                </div>
                              </div>
                            )}
                          </div>
                        </td>
                        <td className="px-3 md:px-6 py-3 md:py-4 text-sm md:text-base">
                          {userAnswers[index] ? (
                            <div className="flex items-start gap-2 text-green-600 font-medium">
                              <div className="flex-shrink-0 mt-0.5">
                                <Check />
                              </div>
                              <div className="break-words">
                                {userAnswers[index]}
                                {item.hint && (
                                  <span className="ml-2 text-sm text-gray-600 italic">
                                    ({item.hint})
                                  </span>
                                )}
                              </div>
                            </div>
                          ) : quizFinished ? (
                            <div>
                              <div className="flex items-start gap-2 text-red-600 font-medium">
                                <div className="flex-shrink-0 mt-0.5">
                                  <X />
                                </div>
                                <div className="break-words">
                                  {item.displayAnswer || item.answer}
                                  {item.hint && (
                                    <span className="ml-2 text-sm text-gray-600 italic">
                                      ({item.hint})
                                    </span>
                                  )}
                                </div>
                              </div>
                              {item.answers && item.answers.length > 1 && (
                                <div className="text-xs text-gray-500 mt-1 ml-7">
                                  Autres réponses acceptées: {item.answers.filter(a => a !== item.displayAnswer).join(', ')}
                                </div>
                              )}
                            </div>
                          ) : (
                            <div className="h-6 bg-gray-100 rounded w-24 md:w-32" />
                          )}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>

            {quizFinished && (
              <div className="bg-white rounded-lg shadow-lg p-4 md:p-6 text-center">
                <h3 className="text-xl md:text-2xl font-bold text-gray-800 mb-4">
                  Quiz terminé !
                </h3>
                <p className="text-lg md:text-xl text-gray-600 mb-6">
                  Score: {answeredCount}/{totalCount} (
                  {Math.round((answeredCount / totalCount) * 100)}%)
                </p>
                <div className="flex flex-col sm:flex-row gap-3 justify-center">
                  <button
                    onClick={() => startQuiz(currentQuiz)}
                    className="flex items-center justify-center gap-2 bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition font-medium"
                  >
                    <Play />
                    Rejouer
                  </button>
                  <button
                    onClick={() => setMode('menu')}
                    className="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-medium"
                  >
                    Retour au menu
                  </button>
                </div>
              </div>
            )}
          </div>
        )}
      </div>
    </div>
  );
}
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<QuizApp />);
        
    </script>
</body>
</html>
